{
  "collections": {
    "users": {
      "description": "Thông tin người dùng",
      "document": {
        "id": "userId (auto từ Firebase Auth)",
        "fields": {
          "email": {
            "type": "string",
            "required": true,
            "description": "Email đăng nhập"
          },
          "displayName": {
            "type": "string",
            "required": true,
            "description": "Tên hiển thị"
          },
          "photoURL": {
            "type": "string",
            "required": false,
            "description": "URL avatar"
          },
          "createdAt": {
            "type": "timestamp",
            "required": true,
            "description": "Thời gian tạo account"
          },
          "updatedAt": {
            "type": "timestamp",
            "required": true,
            "description": "Thời gian cập nhật cuối"
          }
        }
      },
      "indexes": []
    },
    "workspaces": {
      "description": "Workspace/Team - nhóm làm việc",
      "document": {
        "id": "workspaceId (auto-generated)",
        "fields": {
          "name": {
            "type": "string",
            "required": true,
            "description": "Tên workspace"
          },
          "description": {
            "type": "string",
            "required": false,
            "description": "Mô tả workspace"
          },
          "members": {
            "type": "array",
            "required": true,
            "description": "Array of user IDs",
            "items": "string"
          },
          "admins": {
            "type": "array",
            "required": true,
            "description": "Array of admin user IDs",
            "items": "string"
          },
          "createdBy": {
            "type": "string",
            "required": true,
            "description": "User ID của người tạo"
          },
          "createdAt": {
            "type": "timestamp",
            "required": true
          },
          "updatedAt": {
            "type": "timestamp",
            "required": true
          }
        }
      },
      "indexes": [
        {
          "fields": ["members", "createdAt"],
          "description": "Query workspaces by member"
        }
      ]
    },
    "boards": {
      "description": "Board - bảng quản lý tasks",
      "document": {
        "id": "boardId (auto-generated)",
        "fields": {
          "workspaceId": {
            "type": "string",
            "required": true,
            "description": "Reference đến workspace"
          },
          "name": {
            "type": "string",
            "required": true,
            "description": "Tên board"
          },
          "description": {
            "type": "string",
            "required": false
          },
          "columns": {
            "type": "array",
            "required": true,
            "description": "Danh sách columns",
            "items": {
              "id": "string",
              "name": "string",
              "order": "number"
            },
            "default": [
              { "id": "todo", "name": "To Do", "order": 0 },
              { "id": "in-progress", "name": "In Progress", "order": 1 },
              { "id": "done", "name": "Done", "order": 2 }
            ]
          },
          "createdBy": {
            "type": "string",
            "required": true
          },
          "createdAt": {
            "type": "timestamp",
            "required": true
          },
          "updatedAt": {
            "type": "timestamp",
            "required": true
          }
        }
      },
      "indexes": [
        {
          "fields": ["workspaceId", "createdAt"],
          "description": "Query boards by workspace"
        }
      ]
    },
    "tasks": {
      "description": "Task - công việc cần làm",
      "document": {
        "id": "taskId (auto-generated)",
        "fields": {
          "boardId": {
            "type": "string",
            "required": true,
            "description": "Board chứa task này"
          },
          "columnId": {
            "type": "string",
            "required": true,
            "description": "Column hiện tại (todo, in-progress, done)"
          },
          "title": {
            "type": "string",
            "required": true,
            "description": "Tiêu đề task"
          },
          "description": {
            "type": "string",
            "required": false,
            "description": "Mô tả chi tiết task"
          },
          "priority": {
            "type": "string",
            "required": true,
            "enum": ["low", "medium", "high"],
            "default": "medium"
          },
          "dueDate": {
            "type": "timestamp",
            "required": false,
            "description": "Hạn hoàn thành"
          },
          "assignedTo": {
            "type": "array",
            "required": false,
            "description": "Array of user IDs được assign",
            "items": "string"
          },
          "tags": {
            "type": "array",
            "required": false,
            "description": "Tags/labels",
            "items": "string"
          },
          "position": {
            "type": "number",
            "required": true,
            "description": "Thứ tự trong column (cho drag & drop)"
          },
          "createdBy": {
            "type": "string",
            "required": true
          },
          "createdAt": {
            "type": "timestamp",
            "required": true
          },
          "updatedAt": {
            "type": "timestamp",
            "required": true
          }
        }
      },
      "indexes": [
        {
          "fields": ["boardId", "columnId", "position"],
          "description": "Query tasks by board & column, sorted by position"
        },
        {
          "fields": ["assignedTo", "dueDate"],
          "description": "Query tasks by assignee & due date"
        },
        {
          "fields": ["boardId", "dueDate"],
          "description": "Query upcoming tasks"
        }
      ]
    },
    "comments": {
      "description": "Comments trên tasks",
      "document": {
        "id": "commentId (auto-generated)",
        "fields": {
          "taskId": {
            "type": "string",
            "required": true
          },
          "content": {
            "type": "string",
            "required": true
          },
          "mentions": {
            "type": "array",
            "required": false,
            "description": "Array of mentioned user IDs",
            "items": "string"
          },
          "createdBy": {
            "type": "string",
            "required": true
          },
          "createdAt": {
            "type": "timestamp",
            "required": true
          },
          "updatedAt": {
            "type": "timestamp",
            "required": false
          }
        }
      },
      "indexes": [
        {
          "fields": ["taskId", "createdAt"],
          "description": "Query comments by task"
        }
      ]
    },
    "notifications": {
      "description": "Thông báo cho users",
      "document": {
        "id": "notificationId (auto-generated)",
        "fields": {
          "userId": {
            "type": "string",
            "required": true,
            "description": "User nhận notification"
          },
          "type": {
            "type": "string",
            "required": true,
            "enum": ["task_assigned", "task_updated", "mention", "due_date_reminder", "comment"],
            "description": "Loại notification"
          },
          "title": {
            "type": "string",
            "required": true
          },
          "message": {
            "type": "string",
            "required": true
          },
          "read": {
            "type": "boolean",
            "required": true,
            "default": false
          },
          "taskId": {
            "type": "string",
            "required": false,
            "description": "Reference đến task (nếu có)"
          },
          "boardId": {
            "type": "string",
            "required": false
          },
          "createdBy": {
            "type": "string",
            "required": false,
            "description": "User tạo action gây ra notification"
          },
          "createdAt": {
            "type": "timestamp",
            "required": true
          }
        }
      },
      "indexes": [
        {
          "fields": ["userId", "read", "createdAt"],
          "description": "Query unread notifications"
        }
      ]
    },
    "activityLogs": {
      "description": "Activity history log",
      "document": {
        "id": "logId (auto-generated)",
        "fields": {
          "boardId": {
            "type": "string",
            "required": true
          },
          "taskId": {
            "type": "string",
            "required": false
          },
          "action": {
            "type": "string",
            "required": true,
            "enum": ["task_created", "task_updated", "task_deleted", "task_moved", "comment_added"],
            "description": "Loại action"
          },
          "description": {
            "type": "string",
            "required": true,
            "description": "Mô tả hành động (VD: 'moved task from To Do to In Progress')"
          },
          "userId": {
            "type": "string",
            "required": true,
            "description": "User thực hiện action"
          },
          "createdAt": {
            "type": "timestamp",
            "required": true
          }
        }
      },
      "indexes": [
        {
          "fields": ["boardId", "createdAt"],
          "description": "Query activity by board"
        },
        {
          "fields": ["taskId", "createdAt"],
          "description": "Query activity by task"
        }
      ]
    }
  },
  "securityRules": {
    "description": "Firestore Security Rules - Copy vào Firebase Console",
    "rules": "rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper functions\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n    \n    function isOwner(userId) {\n      return isAuthenticated() && request.auth.uid == userId;\n    }\n    \n    function isMemberOfWorkspace(workspaceId) {\n      return isAuthenticated() && \n        request.auth.uid in get(/databases/$(database)/documents/workspaces/$(workspaceId)).data.members;\n    }\n    \n    // Users collection\n    match /users/{userId} {\n      allow read: if isAuthenticated();\n      allow write: if isOwner(userId);\n    }\n    \n    // Workspaces collection\n    match /workspaces/{workspaceId} {\n      allow read: if isMemberOfWorkspace(workspaceId);\n      allow create: if isAuthenticated();\n      allow update: if isMemberOfWorkspace(workspaceId) && \n        request.auth.uid in resource.data.admins;\n      allow delete: if request.auth.uid in resource.data.admins;\n    }\n    \n    // Boards collection\n    match /boards/{boardId} {\n      allow read: if isAuthenticated() && \n        isMemberOfWorkspace(resource.data.workspaceId);\n      allow create: if isAuthenticated();\n      allow update, delete: if isAuthenticated() && \n        (request.auth.uid == resource.data.createdBy || \n         isMemberOfWorkspace(resource.data.workspaceId));\n    }\n    \n    // Tasks collection\n    match /tasks/{taskId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated();\n      allow update: if isAuthenticated() && \n        (request.auth.uid == resource.data.createdBy || \n         request.auth.uid in resource.data.assignedTo);\n      allow delete: if isAuthenticated() && \n        request.auth.uid == resource.data.createdBy;\n    }\n    \n    // Comments collection\n    match /comments/{commentId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated();\n      allow update, delete: if isAuthenticated() && \n        request.auth.uid == resource.data.createdBy;\n    }\n    \n    // Notifications collection\n    match /notifications/{notificationId} {\n      allow read: if isAuthenticated() && \n        request.auth.uid == resource.data.userId;\n      allow create: if isAuthenticated();\n      allow update: if isOwner(resource.data.userId);\n      allow delete: if isOwner(resource.data.userId);\n    }\n    \n    // Activity logs\n    match /activityLogs/{logId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated();\n      allow update, delete: if false; // Activity logs không được sửa/xóa\n    }\n  }\n}"
  }
}
